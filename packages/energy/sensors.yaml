# +-----------------------------------------------------------------------
# | Author: Joakim Lindbom
# | Date: 2023-01-26
# | Licence: GPL V3
# | You know the drill - no warranty, no nothing except the good stuff you can get out of this
# | Parts of this code is based off open source code I found on the Internet. As soon as I locate the origin I'll add a reference to it.
# +-----------------------------------------------------------------------

#TODO: Check if Nordpool is unavailable - "guess" which 5 time windows to recommend ??

sensor:
# sensor.nordpool_kwh_se4_sek_3_10_025
  - platform: nordpool
    region: "SE4"
    precision: 3
    friendly_name: "Electricity prices - SEK/kWh"

# nordpool_kwh_se4_sek_2_095_025
  - platform: nordpool
    VAT: True
    currency: "SEK"
    price_in_cents: True
    # low_price = hour_price < average * low_price_cutoff
    low_price_cutoff: 0.95
    region: "SE4"
    precision: 2
    price_type: kWh
    friendly_name: "Electricity prices - öre/kWh"

  - platform: template
    sensors:
# Checking if hourly price is less than 1 SEK/100 öre or below average for this day
      energy_low_hour:
        friendly_name: "Low price hour for electricity"
        value_template: >-
          {{ (states('sensor.nordpool_kwh_se4_sek_2_095_025')|float < state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'average')|float)
              or states('sensor.nordpool_kwh_se4_sek_2_095_025')|float < 100
          }}
        attribute_templates:
          price: "{{ states('sensor.nordpool_kwh_se4_sek_2_095_025') | float }}"

  - platform: template
    sensors:
      nordpool_today_hr_00_01:
        friendly_name: sensor.nordpool_today h 1
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[0] }}'
      nordpool_today_hr_01_02:
        friendly_name: sensor.nordpool_today h 2
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[1] }}'
      nordpool_today_hr_02_03:
        friendly_name: sensor.nordpool_today h 3
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[2] }}'
      nordpool_today_hr_03_04:
        friendly_name: sensor.nordpool_today h 4
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[3] }}'
      nordpool_today_hr_04_05:
        friendly_name: sensor.nordpool_today h 5
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[4] }}'
      nordpool_today_hr_05_06:
        friendly_name: sensor.nordpool_today h 6
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[5] }}'
      nordpool_today_hr_06_07:
        friendly_name: sensor.nordpool_today h 7
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[6] }}'
      nordpool_today_hr_07_08:
        friendly_name: sensor.nordpool_today h 8
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[7] }}'
      nordpool_today_hr_08_09:
        friendly_name: sensor.nordpool_today h 9
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[8] }}'
      nordpool_today_hr_09_10:
        friendly_name: sensor.nordpool_today h 10
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[9] }}'
      nordpool_today_hr_10_11:
        friendly_name: sensor.nordpool_today h 11
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[10] }}'
      nordpool_today_hr_11_12:
        friendly_name: sensor.nordpool_today h 12
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[11] }}'
      nordpool_today_hr_12_13:
        friendly_name: sensor.nordpool_today h 13
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[12] }}'
      nordpool_today_hr_13_14:
        friendly_name: sensor.nordpool_today h 14
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[13] }}'
      nordpool_today_hr_14_15:
        friendly_name: sensor.nordpool_today h 15
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[14] }}'
      nordpool_today_hr_15_16:
        friendly_name: sensor.nordpool_today h 16
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[15] }}'
      nordpool_today_hr_16_17:
        friendly_name: sensor.nordpool_today h 17
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[16] }}'
      nordpool_today_hr_17_18:
        friendly_name: sensor.nordpool_today h 18
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[17] }}'
      nordpool_today_hr_18_19:
        friendly_name: sensor.nordpool_today h 19
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[18] }}'
      nordpool_today_hr_19_20:
        friendly_name: sensor.nordpool_today h 20
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[19] }}'
      nordpool_today_hr_20_21:
        friendly_name: sensor.nordpool_today h 21
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[20] }}'
      nordpool_today_hr_21_22:
        friendly_name: sensor.nordpool_today h 22
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[21] }}'
      nordpool_today_hr_22_23:
        friendly_name: sensor.nordpool_today h 23
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[22] }}'
      nordpool_today_hr_23_24:
        friendly_name: sensor.nordpool_today h 24
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "today")[23] }}'
      nordpool_tomorrow_hr_00_01:
        friendly_name: sensor.nordpool_tomorrow h 1
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[0] }}'
      nordpool_tomorrow_hr_01_02:
        friendly_name: sensor.nordpool_tomorrow h 2
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[1] }}'
      nordpool_tomorrow_hr_02_03:
        friendly_name: sensor.nordpool_tomorrow h 3
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[2] }}'
      nordpool_tomorrow_hr_03_04:
        friendly_name: sensor.nordpool_tomorrow h 4
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[3] }}'
      nordpool_tomorrow_hr_04_05:
        friendly_name: sensor.nordpool_tomorrow h 5
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[4] }}'
      nordpool_tomorrow_hr_05_06:
        friendly_name: sensor.nordpool_tomorrow h 6
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[5] }}'
      nordpool_tomorrow_hr_06_07:
        friendly_name: sensor.nordpool_tomorrow h 7
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[6] }}'
      nordpool_tomorrow_hr_07_08:
        friendly_name: sensor.nordpool_tomorrow h 8
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[7] }}'
      nordpool_tomorrow_hr_08_09:
        friendly_name: sensor.nordpool_tomorrow h 9
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[8] }}'
      nordpool_tomorrow_hr_09_10:
        friendly_name: sensor.nordpool_tomorrow h 10
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[9] }}'
      nordpool_tomorrow_hr_10_11:
        friendly_name: sensor.nordpool_tomorrow h 11
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[10] }}'
      nordpool_tomorrow_hr_11_12:
        friendly_name: sensor.nordpool_tomorrow h 12
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[11] }}'
      nordpool_tomorrow_hr_12_13:
        friendly_name: sensor.nordpool_tomorrow h 13
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[12] }}'
      nordpool_tomorrow_hr_13_14:
        friendly_name: sensor.nordpool_tomorrow h 14
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[13] }}'
      nordpool_tomorrow_hr_14_15:
        friendly_name: sensor.nordpool_tomorrow h 15
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[14] }}'
      nordpool_tomorrow_hr_15_16:
        friendly_name: sensor.nordpool_tomorrow h 16
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[15] }}'
      nordpool_tomorrow_hr_16_17:
        friendly_name: sensor.nordpool_tomorrow h 17
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[16] }}'
      nordpool_tomorrow_hr_17_18:
        friendly_name: sensor.nordpool_tomorrow h 18
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[17] }}'
      nordpool_tomorrow_hr_18_19:
        friendly_name: sensor.nordpool_tomorrow h 19
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[18] }}'
      nordpool_tomorrow_hr_19_20:
        friendly_name: sensor.nordpool_tomorrow h 20
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[19] }}'
      nordpool_tomorrow_hr_20_21:
        friendly_name: sensor.nordpool_tomorrow h 21
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[20] }}'
      nordpool_tomorrow_hr_21_22:
        friendly_name: sensor.nordpool_tomorrow h 22
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[21] }}'
      nordpool_tomorrow_hr_22_23:
        friendly_name: sensor.nordpool_tomorrow h 23
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[22] }}'
      nordpool_tomorrow_hr_23_24:
        friendly_name: sensor.nordpool_tomorrow h 24
        icon_template: mdi:cash
        unit_of_measurement: "Öre/kWh"
        value_template: '{{ state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "tomorrow")[23] }}'

  - platform: template
    sensors:
      cheapest_hours_energy_today_1h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 1 hour
        value_template: >
          {%-   set numberOfSequentialHours = 1                                                                      -%}
          {%-   set lastHour = 23                                                                                    -%}
          {%-   set firstHour = 0                                                                                    -%}
          {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
          {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
          {%-     set ns.counter = 0.0                                                                               -%}
          {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
          {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
          {%-     endfor                                                                                             -%}
          {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
          {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
          {%-       set ns.cheapestPrice = ns.counter                                                                -%}
          {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
          {%-     endif                                                                                              -%}
          {%-   endfor                                                                                               -%}
          {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
          {{    ns.cheapestHour }}
        attribute_templates:
          mean_price: >
            {%-   set numberOfSequentialHours = 1                                                                      -%}
            {%-   set lastHour = 23                                                                                    -%}
            {%-   set firstHour = 0                                                                                    -%}
            {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
            {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
            {%-     set ns.counter = 0.0                                                                               -%}
            {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
            {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
            {%-     endfor                                                                                             -%}
            {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
            {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
            {%-       set ns.cheapestPrice = ns.counter                                                                -%}
            {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
            {%-     endif                                                                                              -%}
            {%-   endfor                                                                                               -%}
            {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
            {{    ns.cheapestPrice }}
      cheapest_hours_energy_today_2h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 2 hours
        value_template: >
          {%-   set numberOfSequentialHours = 2                                                                      -%}
          {%-   set lastHour = 23                                                                                    -%}
          {%-   set firstHour = 0                                                                                    -%}
          {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
          {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
          {%-     set ns.counter = 0.0                                                                               -%}
          {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
          {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
          {%-     endfor                                                                                             -%}
          {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
          {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
          {%-       set ns.cheapestPrice = ns.counter                                                                -%}
          {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
          {%-     endif                                                                                              -%}
          {%-   endfor                                                                                               -%}
          {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
          {{    ns.cheapestHour }}
        attribute_templates:
          mean_price: >
            {%-   set numberOfSequentialHours = 2                                                                      -%}
            {%-   set lastHour = 23                                                                                    -%}
            {%-   set firstHour = 0                                                                                    -%}
            {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
            {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
            {%-     set ns.counter = 0.0                                                                               -%}
            {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
            {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
            {%-     endfor                                                                                             -%}
            {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
            {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
            {%-       set ns.cheapestPrice = ns.counter                                                                -%}
            {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
            {%-     endif                                                                                              -%}
            {%-   endfor                                                                                               -%}
            {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
            {{    ns.cheapestPrice }}

      cheapest_hours_energy_today_3h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 3 hours
        value_template: >
          {%-   set numberOfSequentialHours = 3                                                                      -%}
          {%-   set lastHour = 23                                                                                    -%}
          {%-   set firstHour = 0                                                                                    -%}
          {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
          {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
          {%-     set ns.counter = 0.0                                                                               -%}
          {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
          {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
          {%-     endfor                                                                                             -%}
          {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
          {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
          {%-       set ns.cheapestPrice = ns.counter                                                                -%}
          {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
          {%-     endif                                                                                              -%}
          {%-   endfor                                                                                               -%}
          {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
          {{    ns.cheapestHour }}
        attribute_templates:
          mean_price: >
            {%-   set numberOfSequentialHours = 3                                                                      -%}
            {%-   set lastHour = 23                                                                                    -%}
            {%-   set firstHour = 0                                                                                    -%}
            {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
            {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
            {%-     set ns.counter = 0.0                                                                               -%}
            {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
            {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
            {%-     endfor                                                                                             -%}
            {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
            {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
            {%-       set ns.cheapestPrice = ns.counter                                                                -%}
            {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
            {%-     endif                                                                                              -%}
            {%-   endfor                                                                                               -%}
            {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
            {{    ns.cheapestPrice }}

      cheapest_hours_energy_today_4h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 4 hours
        value_template: >
          {%-   set numberOfSequentialHours = 4                                                                      -%}
          {%-   set lastHour = 23                                                                                    -%}
          {%-   set firstHour = 0                                                                                    -%}
          {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
          {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
          {%-     set ns.counter = 0.0                                                                               -%}
          {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
          {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
          {%-     endfor                                                                                             -%}
          {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
          {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
          {%-       set ns.cheapestPrice = ns.counter                                                                -%}
          {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
          {%-     endif                                                                                              -%}
          {%-   endfor                                                                                               -%}
          {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
          {{    ns.cheapestHour }}
        attribute_templates:
          mean_price: >
            {%-   set numberOfSequentialHours = 4                                                                      -%}
            {%-   set lastHour = 23                                                                                    -%}
            {%-   set firstHour = 0                                                                                    -%}
            {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
            {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
            {%-     set ns.counter = 0.0                                                                               -%}
            {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
            {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
            {%-     endfor                                                                                             -%}
            {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
            {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
            {%-       set ns.cheapestPrice = ns.counter                                                                -%}
            {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
            {%-     endif                                                                                              -%}
            {%-   endfor                                                                                               -%}
            {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
            {{    ns.cheapestPrice }}

      cheapest_hours_energy_today_5h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 5 hours
        value_template: >
          {%-   set numberOfSequentialHours = 5                                                                      -%}
          {%-   set lastHour = 23                                                                                    -%}
          {%-   set firstHour = 0                                                                                    -%}
          {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
          {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
          {%-     set ns.counter = 0.0                                                                               -%}
          {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
          {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
          {%-     endfor                                                                                             -%}
          {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
          {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
          {%-       set ns.cheapestPrice = ns.counter                                                                -%}
          {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
          {%-     endif                                                                                              -%}
          {%-   endfor                                                                                               -%}
          {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
          {{    ns.cheapestHour }}
        attribute_templates:
          mean_price: >
            {%-   set numberOfSequentialHours = 5                                                                      -%}
            {%-   set lastHour = 23                                                                                    -%}
            {%-   set firstHour = 0                                                                                    -%}
            {%-   set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") , cheapestPrice=999.00)        -%}
            {%-   for i in range(firstHour + numberOfSequentialHours, lastHour+1)                                      -%}
            {%-     set ns.counter = 0.0                                                                               -%}
            {%-     for j in range(i-numberOfSequentialHours, i)                                                       -%}
            {%-       set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'today')[j]    -%}
            {%-     endfor                                                                                             -%}
            {%-     set ns.list = ns.list + [ns.counter]                                                               -%}
            {%-     if ns.counter < ns.cheapestPrice                                                                   -%}
            {%-       set ns.cheapestPrice = ns.counter                                                                -%}
            {%-       set ns.cheapestHour = today_at("00:00") + timedelta( hours = ( i - numberOfSequentialHours))     -%}
            {%-     endif                                                                                              -%}
            {%-   endfor                                                                                               -%}
            {%-   set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours                                    -%}
            {{    ns.cheapestPrice }}

      cheapest_hours_energy_tomorrow_1h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 1 hour
        value_template: >
          {%- set numberOfSequentialHours = 1 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter < ns.cheapestPrice -%}
                {%- set ns.cheapestPrice = ns.counter -%}
                {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.cheapestHour }}
            {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
            {%- set cheapestPrice = ns.cheapestPrice  -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 1 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter < ns.cheapestPrice -%}
                  {%- set ns.cheapestPrice = ns.counter -%}
                  {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
              {{ ns.cheapestPrice }}            
              {%- set cheapestPrice = ns.cheapestPrice  -%}
            {%- endif -%}

      cheapest_hours_energy_tomorrow_2h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 2 hours
        value_template: >
          {%- set numberOfSequentialHours = 2 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter < ns.cheapestPrice -%}
                {%- set ns.cheapestPrice = ns.counter -%}
                {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.cheapestHour }}
            {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 2 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter < ns.cheapestPrice -%}
                  {%- set ns.cheapestPrice = ns.counter -%}
                  {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
              {{ ns.cheapestPrice }}            
              {%- set cheapestPrice = ns.cheapestPrice  -%}
            {%- endif -%}

      cheapest_hours_energy_tomorrow_3h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 3 hours
        value_template: >
          {%- set numberOfSequentialHours = 3 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter < ns.cheapestPrice -%}
                {%- set ns.cheapestPrice = ns.counter -%}
                {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.cheapestHour }}
            {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 3 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter < ns.cheapestPrice -%}
                  {%- set ns.cheapestPrice = ns.counter -%}
                  {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
              {{ ns.cheapestPrice }}            
              {%- set cheapestPrice = ns.cheapestPrice  -%}
            {%- endif -%}

      cheapest_hours_energy_tomorrow_4h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 4 hours
        value_template: >
          {%- set numberOfSequentialHours = 4 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter < ns.cheapestPrice -%}
                {%- set ns.cheapestPrice = ns.counter -%}
                {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.cheapestHour }}
            {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 4 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter < ns.cheapestPrice -%}
                  {%- set ns.cheapestPrice = ns.counter -%}
                  {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
              {{ ns.cheapestPrice }}            
              {%- set cheapestPrice = ns.cheapestPrice  -%}
            {%- endif -%}

      cheapest_hours_energy_tomorrow_5h:
        device_class: timestamp
        friendly_name: Cheapest sequential electricity 5 hours
        value_template: >
          {%- set numberOfSequentialHours = 5 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter < ns.cheapestPrice -%}
                {%- set ns.cheapestPrice = ns.counter -%}
                {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.cheapestHour }}
            {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 5 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], cheapestHour=today_at("00:00") + timedelta( hours = (24)), cheapestPrice=999.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter < ns.cheapestPrice -%}
                  {%- set ns.cheapestPrice = ns.counter -%}
                  {%- set ns.cheapestHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.cheapestPrice = ns.cheapestPrice / numberOfSequentialHours -%}
              {{ ns.cheapestPrice }}            
              {%- set cheapestPrice = ns.cheapestPrice  -%}
            {%- endif -%}

# Most expensive
# TODO:  Check if sensor data is available
      expensive_hours_energy_today_1h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 1 hour
        value_template: >
          {%- set numberOfSequentialHours = 1 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 1 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}

      expensive_hours_energy_today_2h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 2 hour
        value_template: >
          {%- set numberOfSequentialHours = 2 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 2 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}

      expensive_hours_energy_today_3h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 3 hour
        value_template: >
          {%- set numberOfSequentialHours = 3 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 3 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}

      expensive_hours_energy_today_4h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 4 hour
        value_template: >
          {%- set numberOfSequentialHours = 4 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 4 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}

      expensive_hours_energy_today_5h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 5 hour
        value_template: >
          {%- set numberOfSequentialHours = 5 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 5 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") , expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025',  'today')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours  = ( i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}

      expensive_hours_energy_tomorrow_1h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 1 hour
        value_template: >
          {%- set numberOfSequentialHours = 1 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 1 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}
            {%- endif -%}

      expensive_hours_energy_tomorrow_2h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 2 hour
        value_template: >
          {%- set numberOfSequentialHours = 2 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 2 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}
            {%- endif -%}

      expensive_hours_energy_tomorrow_3h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 3 hour
        value_template: >
          {%- set numberOfSequentialHours = 3 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 3 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}
            {%- endif -%}

      expensive_hours_energy_tomorrow_4h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 4 hour
        value_template: >
          {%- set numberOfSequentialHours = 4 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 4 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}
            {%- endif -%}

      expensive_hours_energy_tomorrow_5h:
        device_class: timestamp
        friendly_name: Most expensive sequential electricity 5 hour
        value_template: >
          {%- set numberOfSequentialHours = 5 -%}
          {%- set lastHour = 23 -%}
          {%- set firstHour = 0 -%}

          {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
            {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
            {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
              {%- set ns.counter = 0.0 -%}
              {%- for j in range(i-numberOfSequentialHours, i) -%}
                {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
              {%- endfor -%}
              {%- set ns.list = ns.list + [ns.counter] -%}
              {%- if ns.counter > ns.expensivePrice -%}
                {%- set ns.expensivePrice = ns.counter -%}
                {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
              {%- endif -%}
            {%- endfor -%}
            {{ ns.expensiveHour }}
            {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
            {%- set expensivePrice = ns.expensivePrice  -%}
          {%- endif -%}
        attribute_templates:
          mean_price: >
            {%- set numberOfSequentialHours = 5 -%}
            {%- set lastHour = 23 -%}
            {%- set firstHour = 0 -%}

            {%- if state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow_valid') == true -%}
              {%- set ns = namespace(counter=0, list=[], expensiveHour=today_at("00:00") + timedelta( hours = (24)), expensivePrice=0.00) -%}
              {%- for i in range(firstHour + numberOfSequentialHours, lastHour+1) -%}
                {%- set ns.counter = 0.0 -%}
                {%- for j in range(i-numberOfSequentialHours, i) -%}
                  {%- set ns.counter = ns.counter + state_attr('sensor.nordpool_kwh_se4_sek_2_095_025', 'tomorrow')[j] -%}
                {%- endfor -%}
                {%- set ns.list = ns.list + [ns.counter] -%}
                {%- if ns.counter > ns.expensivePrice -%}
                  {%- set ns.expensivePrice = ns.counter -%}
                  {%- set ns.expensiveHour = today_at("00:00") + timedelta( hours = (24 + i - numberOfSequentialHours)) -%}
                {%- endif -%}
              {%- endfor -%}
              {%- set ns.expensivePrice = ns.expensivePrice / numberOfSequentialHours -%}
              {{ ns.expensivePrice }}            
              {%- set expensivePrice = ns.expensivePrice  -%}
            {%- endif -%}

# Summary sensors
      cheapest_time_windows_today:
       device_class: monetary
       friendly_name: Cheapest hours for electricity today
       value_template: >
           {{ "%0.0f"| format(state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "average")|float)  }}
       attribute_templates:
         mean_price_1h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_today_1h", "mean_price")|float)  }}
         mean_price_2h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_today_2h", "mean_price")|float)  }}
         mean_price_3h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_today_3h", "mean_price")|float)  }}
         mean_price_4h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_today_4h", "mean_price")|float)  }}
         mean_price_5h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_today_5h", "mean_price")|float)  }}

      cheapest_time_windows_tomorrow:
       device_class: monetary
       friendly_name: Cheapest hours for electricity tomorrow
       value_template: >
           {{ "%0.0f"| format(state_attr("sensor.nordpool_kwh_se4_sek_2_095_025", "average")|float)  }}
       attribute_templates:
         mean_price_1h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_tomorrow_1h", "mean_price")|float)  }}
         mean_price_2h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_tomorrow_2h", "mean_price")|float)  }}
         mean_price_3h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_tomorrow_3h", "mean_price")|float)  }}
         mean_price_4h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_tomorrow_4h", "mean_price")|float)  }}
         mean_price_5h: >
           {{ "%0.0f"| format(state_attr("sensor.cheapest_hours_energy_tomorrow_5h", "mean_price")|float)  }}

